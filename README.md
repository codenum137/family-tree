# 中文家谱可视化工具

一个专门用于生成中文家族谱系图的Python工具，支持传统家谱布局和字辈显示。

## 主要特性

- 🌳 **智能布局**: 前两代横向布局，后续代数纵向布局，节省空间
- 📝 **双格式支持**: 支持Markdown和JSON两种数据格式
- 🏷️ **字辈标签**: 支持在每代最左边显示字辈信息
- 🎨 **传统样式**: 使用折线连接，符合传统家谱样式
- 🇨🇳 **中文优化**: 完美支持中文字符显示和纵向排列

## 快速开始

### 1. 环境要求

```bash
pip install matplotlib numpy
```

### 2. 创建家谱数据

在`markdown_file/`文件夹中创建`.md`文件，格式如下：

```markdown
# 李氏家谱

## 字辈: 文字辈,武字辈,德字辈,才字辈

- 文祖
  - 武长子
    - 德孙A
      - 才重孙A1
      - 才重孙A2
    - 德孙B
  - 武次子
    - 德孙C
```

### 3. 运行程序

```bash
# 修改main.py中的TITLE变量为你的文件名（不含.md扩展名）
python main.py
```

## 数据格式说明

### Markdown格式（推荐使用）

**基本语法：**
- `# 标题` - 设置家谱标题
- `## 字辈: 代1,代2,代3` - 设置字辈信息（可选）
- `- 人名` - 添加家族成员
- 使用缩进（2个空格）表示代际关系

**示例：**
```markdown
# 王氏家谱
## 字辈: 世字辈,德字辈,传字辈,家字辈
- 世祖
  - 德子
    - 传孙
      - 家曾孙
```

### JSON格式

```json
{
    "name": "祖先名字",
    "children": [
        {
            "name": "子女名字",
            "children": [...]
        }
    ],
    "generations": ["第一代", "第二代", "第三代"]
}
```

## 文件结构

```
family-tree/
├── main.py                 # 主程序文件
├── markdown_parser.py      # Markdown解析器
├── markdown_file/          # Markdown格式家谱数据
│   ├── template.md        # 格式模板和说明
│   └── *.md               # 家谱数据文件
├── json_file/             # JSON格式家谱数据
│   └── *.json             # 家谱数据文件
├── 瓜藤图/                 # 生成的家谱图片
│   └── *.png              # 输出的家谱图
└── 原文件/                 # 原始家谱图片
    └── *.jpg/*.png        # 原始图片文件
```

## 配置选项

在`main.py`中可以调整以下参数：

```python
# 文件选择
TITLE = "你的家谱文件名"  # 不含扩展名

# 节点大小
NODE_WIDTH_HORIZONTAL = 2.5    # 横向节点宽度
NODE_HEIGHT_HORIZONTAL = 1.2   # 横向节点高度
NODE_WIDTH_VERTICAL = 0.8      # 纵向节点宽度
NODE_HEIGHT_VERTICAL = 2.5     # 纵向节点高度

# 间距设置
PADDING_HORIZONTAL = 0.3       # 横向填充
PADDING_VERTICAL = 0.5         # 纵向填充
LEVEL_SPACING = 3              # 层级间距
```

## 功能特点

### 1. 智能文字布局
- **前两代**: 使用横向文字布局，节省垂直空间
- **第三代及以后**: 使用纵向文字布局，节省水平空间

### 2. 字辈标签显示
- 在每代最左边显示字辈标签
- 带有圆角背景，便于识别
- 没有字辈信息时自动隐藏

### 3. 传统家谱样式
- 使用三段式折线连接（垂直→水平→垂直）
- 符合传统家谱的视觉习惯

### 4. 双格式支持
- **Markdown优先**: 系统优先加载.md文件
- **JSON备选**: 如无.md文件则加载.json文件
- **易于编辑**: Markdown格式更容易编辑和维护

## 使用示例

1. **创建家谱数据**：
   复制`markdown_file/template.md`为新文件，按格式填入家族数据

2. **修改配置**：
   在`main.py`中修改`TITLE`变量为你的文件名

3. **生成家谱**：
   运行`python main.py`，程序会自动生成家谱图并保存

4. **查看结果**：
   生成的家谱图保存在`瓜藤图/`文件夹中

## 注意事项

- 确保安装了SimHei字体以正确显示中文
- Markdown文件使用UTF-8编码
- 字辈信息用逗号分隔，支持中英文冒号
- 节点名称建议使用2-3个中文字符以获得最佳显示效果

## 技术栈

- **Python 3.x**
- **Matplotlib** - 图形绘制
- **NumPy** - 数值计算
- **JSON** - 数据解析
- **正则表达式** - 文本处理

---

*这个工具专门为中文家谱制作而设计，遵循传统家谱的布局和显示习惯。*